# Телеграм-бот для парсинга и сохранения цен

## Описание
Этот  Telegram-бот позволяет пользователям загружать Excel-файл, содержащий URL-адреса веб-сайтов и XPath-выражения для извлечения цен на товары. Бот обрабатывает файл, сохраняет данные в локальную базу данных SQLite и может парсить цены для расчета средних значений.

## Функции
- Принимает Excel-файл с колонками: `title`, `url`, `xpath`
- Сохраняет данные в базе SQLite
- Парсит цены с указанных сайтов
- Обрабатывает разные форматы цен, включая валютные символы и пробелы
- Возвращает пользователю извлеченные данные и средние цены

## Установка
### Требования
- Python 3.10+
- pip
- Виртуальное окружение (рекомендуется)

### Настройка
1. Клонируйте репозиторий:
   ```sh
   git clone https://github.com/UnWreckerNick/TGBot_ExcelParser
   cd <repository_folder>
   ```
2. Создайте и активируйте виртуальное окружение:
   ```sh
   python -m venv .venv
   source .venv/bin/activate  # Для Linux
   .venv\Scripts\activate  # Для Windows
   ```
3. Установите зависимости:
   ```sh
   pip install -r requirements.txt
   ```
4. Создайте файл `.env` и добавьте URL базы данных и токен бота:
   ```sh
   DATABASE_URL=sqlite+aiosqlite:///data.db
   TELEGRAM_BOT_TOKEN="токен_вашего_бота"
   ```
5. Инициализируйте базу данных:
   ```sh
   python -m app.init_db
   ```

## Использование
1. Запустите бота:
   ```sh
   python -m app.bot
   ```
2. В вашем Telegram боте отправьте команду `/start` для инициализации бота.
3. Отправьте команду `/upload` и следом Excel-файл формате `*.xslx`.
4. Бот обработает файл, сохранит данные и вернет содержимое.
5. При необходимости запустите парсинг цен командой `/parse` и получите средние значения.

## Формат файла
Excel-файл должен содержать следующие колонки:
| title | url  | xpath |
|-------|------|-------|
| Пример товара | https://example.com/product | //*[@class='price'] |

## База данных
Данные хранятся в SQLite (`data.db`) с использованием следующей модели:
```sql
class ExcelData(Base):
    __tablename__ = "excel_data"
    id: Mapped[int] = mapped_column(primary_key=True)
    title: Mapped[str]
    url: Mapped[str]
    xpath: Mapped[str]
```

## Зависимости
- `aiogram` - для работы с Telegram API
- `pandas` - для обработки Excel-файлов
- `sqlite3` - для хранения данных
- `httpx` - для асинхронных HTTP-запросов
- `lxml` - для парсинга HTML и извлечения цен

## Автор
Кузнецов Николай
